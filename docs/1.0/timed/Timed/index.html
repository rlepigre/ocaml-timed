<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Timed (timed.Timed)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">timed</a> &#x00BB; Timed</nav><header class="odoc-preamble"><h1>Module <code><span>Timed</span></code></h1><p>Timed references for imperative state. This module provides an alternative type for references (or mutable cells) supporting undo/redo operations. In particular, an abstract notion of time is used to capture the state of the references at any given point, so that it can be restored. Note that usual reference operations only have a constant time / memory overhead (compared to those of <code>Stdlib</code>).</p><ul class="at-tags"><li class="author"><span class="at-tag">author</span> Christophe Raffalli</li></ul><ul class="at-tags"><li class="author"><span class="at-tag">author</span> Rodolphe Lepigre</li></ul></header><div class="odoc-content"><p>Note that this module allocates two blocks of memory at initialization for its internal state. They occupy a total of six words.</p><div class="odoc-spec"><div class="spec type" id="type-ref" class="anchored"><a href="#type-ref" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a ref</span></span></code></div><div class="spec-doc"><p>Type of references similar to <code>Stdlib</code>.ref. Note that it uses three words of memory, while <code>Stdlib</code>.ref uses two. Note that it is <b>unsafe to marshal</b> elements of this type using functions of the <code>Marshal</code> module or <code>Stdlib</code>.output_value. In fact, it is possible to work around this limitation with <a href="#val-unsafe_reset"><code>unsafe_reset</code></a>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-ref" class="anchored"><a href="#val-ref" class="anchor"></a><code><span><span class="keyword">val</span> ref : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-ref">ref</a></span></span></code></div><div class="spec-doc"><p><code>ref v</code> creates a new reference holding the value <code>v</code>. This operation runs in constant time, and has a very small (even negligible) overhead compared to <code>Stdlib</code>.ref. This function only allocates one block of memory of three words (against two for <code>Stdlib</code>.ref).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(!)" class="anchored"><a href="#val-(!)" class="anchor"></a><code><span><span class="keyword">val</span> (!) : <span><span><span class="type-var">'a</span> <a href="#type-ref">ref</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>!r</code> returns the current value of <code>r</code>. This operation is constant time and has a negligible overhead compared to <code>Stdlib</code>.((!)). Moreover, it does not perform any memory allocation.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(:=)" class="anchored"><a href="#val-(:=)" class="anchor"></a><code><span><span class="keyword">val</span> (:=) : <span><span><span class="type-var">'a</span> <a href="#type-ref">ref</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>r := v</code> sets the value of the reference <code>r</code> to <code>v</code>. This operation has a very small overhead compared to <code>Stdlib</code>.((:=)) if no time has been saved with <a href="Time/index.html#val-save"><code>Time.save</code></a>. Nonetheless, it is always constant time. Note that this function does not perform any memory allocation, except when the current “time” is accessible (or has not been collected) and <code>r</code> is being updated for the first time in the current “time”. If that is the case, two blocks of memory are allocated, for a total of six words.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-incr" class="anchored"><a href="#val-incr" class="anchor"></a><code><span><span class="keyword">val</span> incr : <span><span>int <a href="#type-ref">ref</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>incr r</code> is equivalent to <code>r := !r + 1</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-decr" class="anchored"><a href="#val-decr" class="anchor"></a><code><span><span class="keyword">val</span> decr : <span><span>int <a href="#type-ref">ref</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>decr r</code> is equivalent to <code>r := !r - 1</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Time" class="anchored"><a href="#module-Time" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Time/index.html">Time</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The <code>Time</code> module provides an abstract representation of time, used to set a point from which updates to references are recorded to allow undoing (of redoing) the corresponding changes.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pure_apply" class="anchored"><a href="#val-pure_apply" class="anchor"></a><code><span><span class="keyword">val</span> pure_apply : <span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span> )</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span></span></code></div><div class="spec-doc"><p><code>pure_apply f v</code> computes the result of <code>f v</code>, but reverts the updates to references before returning the value.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-pure_test" class="anchored"><a href="#val-pure_test" class="anchor"></a><code><span><span class="keyword">val</span> pure_test : <span><span>( <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool )</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>pure_test p v</code> applies the predicate <code>p</code> to <code>v</code> (i.e., compute <code>p v</code>) and returns the result, reverting the updates made to reference if the result is <code>false</code>. Updates are preserved if the result is <code>true</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-unsafe_reset" class="anchored"><a href="#val-unsafe_reset" class="anchor"></a><code><span><span class="keyword">val</span> unsafe_reset : <span><span><span class="type-var">'a</span> <a href="#type-ref">ref</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>unsafe_reset r</code> can be used to work around the marshaling limitations. In fact, there is no problem marshaling data structures containing references (i.e., values of type <a href="#type-ref"><code>ref</code></a>). However, unmarshaling such a value will leave it in an inconsistent state with respect to the library. Hence, it is <b>absolutely necessary</b> to call <code>unsafe_reset</code> on every element of type <a href="#type-ref"><code>ref</code></a> in an unmarshaled value. Doing so will make the system believe that the reference has just been created. Note that <code>unsafe_reset</code> <b>should not be used in any other situation</b>, and especially if the given <code>r</code> has already been updated with <a href="#val-(:=)"><code>(:=)</code></a>.</p></div></div></div></body></html>